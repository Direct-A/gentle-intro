# åŸºç¡€

## ç›®å½•

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [ä½ å¥½,ä¸–ç•Œ!](#%E4%BD%A0%E5%A5%BD%E4%B8%96%E7%95%8C)
- [å¾ªç¯å’Œæ¡ä»¶è¯­å¥](#%E5%BE%AA%E7%8E%AF%E5%92%8C%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5)
- [å¼€å§‹å †ç§¯æœ¨å§](#%E5%BC%80%E5%A7%8B%E5%A0%86%E7%A7%AF%E6%9C%A8%E5%90%A7)
- [ç¡®åˆ‡çš„å‡½æ•°ç±»å‹](#%E7%A1%AE%E5%88%87%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B)
- [å­¦ä¼šæ‰¾åˆ°æ•‘å‘½ç¨»è‰](#%E5%AD%A6%E4%BC%9A%E6%89%BE%E5%88%B0%E6%95%91%E5%91%BD%E7%A8%BB%E8%8D%89)
- [æ•°ç»„å’Œåˆ‡ç‰‡](#%E6%95%B0%E7%BB%84%E5%92%8C%E5%88%87%E7%89%87)
- [åˆ‡å’Œå‰²](#%E5%88%87%E5%92%8C%E5%89%B2)
- [å¯é€‰ï¼ˆOptionï¼‰å€¼](#%E5%8F%AF%E9%80%89option%E5%80%BC)
- [å‘é‡](#%E5%90%91%E9%87%8F)
- [è¿­ä»£å™¨](#%E8%BF%AD%E4%BB%A3%E5%99%A8)
- [æ›´å¤šå…³äºå‘é‡](#%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E5%90%91%E9%87%8F)
- [å­—ç¬¦ä¸²](#%E5%AD%97%E7%AC%A6%E4%B8%B2)
- [æ’æ›²: è·å–å‘½ä»¤è¡Œå‚æ•°](#%E6%8F%92%E6%9B%B2-%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0)
- [åŒ¹é…](#%E5%8C%B9%E9%85%8D)
- [è¯»å–æ–‡ä»¶](#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## ä½ å¥½,ä¸–ç•Œ!

ä» C è¯­è¨€çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬è¯ç”Ÿä¹‹åï¼Œ"hello world"å°±æˆä¸ºäº†æµ‹è¯•ç¼–è¯‘å™¨å¹¶è¿è¡Œçš„ç¬¬ä¸€ä¸ªå®ä¾‹ç¨‹åºã€‚

```rust
// hello.rs
fn main() {
    println!("Hello, World!");
}
```

```
$ rustc hello.rs
$ ./hello
Hello, World!
```

Rust æ˜¯ä¸€ç§ä½¿ç”¨åˆ†å·çš„èŠ±æ‹¬å·è¯­è¨€ï¼Œå¹¶ä¸”ä½¿ç”¨ C++ é£æ ¼æ³¨é‡Šå’Œä»¥åŠ`main`å‡½æ•°â€”â€”å°±ç›®å‰æ¥è¯´ï¼Œè¿˜å¾ˆå¸¸ç†Ÿæ‚‰å§ã€‚
`æ„Ÿå¹å·{!}`è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª _å®_ è°ƒç”¨ã€‚
è¿™å¯¹äº C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªé€€æ­¥ï¼Œå› ä¸ºå®ƒç”¨äº†éå¸¸ç®€é™‹çš„ C å®â€”â€”ä½†æˆ‘å¯ä»¥ä¿è¯è¿™é‡Œçš„å®èƒ½ä¼šæ›´å¼ºå¤§å’Œæ›´ç†æ™ºã€‚

å¯¹äºå…¶ä»–äººæ¥è¯´ï¼Œå°±æ˜¯â€œç°åœ¨å¥½äº†ï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œç °ï¼â€ã€‚
ä½†æ˜¯ï¼Œä½ è¦çŸ¥é“ Rust ç¼–è¯‘å™¨å¾ˆå¼ºçš„ï¼›å¦‚æœæ¼äº†é‚£ä¸ªå¹å·ï¼Œä½ ä¼šå¾—åˆ°:

```
error[E0425]: unresolved name `println`
  --> hello2.rs:2:5
  |
2 |     println("Hello, World!");
  |     ^^^^^^^ did you mean the macro `println!`?
```

å­¦ä¹ ä¸€é—¨è¯­è¨€å°±æ„å‘³ç€è¦äº†è§£å®ƒçš„é”™è¯¯ã€‚åœ¨ä½ æœ€å¼€å§‹å­¦ä¹ çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°ç¼–è¯‘å™¨è¿”å›çš„å¾ˆå¤šçº¢è‰²æ ‡è®°ï¼Œè¿™æ—¶ä½ åº”è¯¥æŠŠä»–å½“åšä¸¥æ ¼å´å‹å¥½çš„å¸®æ‰‹ï¼Œè€Œä¸æ˜¯ä¸€å°å¯¹ä½  _å¤§å–Šå¤§å«{shouting}_ çš„ç”µè„‘ã€‚å¯¹ç¼–ç¨‹äººå‘˜æ¥è¯´ï¼Œç¼–è¯‘å™¨æå‰æŒ‡å‡ºä½ çš„é”™è¯¯æ€»è¦å¥½è¿‡ç¨‹åºåœ¨ç”¨æˆ·é¢å‰å´©æºƒã€‚

ä¸‹é¢è¿›è¡Œä¸€ä¸ª _å˜é‡{variable}_ çš„ä»‹ç»ğŸ˜‹ï¼š

```rust
// let1.rs
fn main() {
    let answer = 42;
    println!("Hello {}", answer);
}
```

Rust ä¸­æ‹¼å†™é”™è¯¯å±äº _ç¼–è¯‘{compile}_ é”™è¯¯ï¼Œè€Œä¸æ˜¯ç±»ä¼¼ Python æˆ– JavaScript ç­‰åŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶é”™è¯¯ã€‚
è¿™ä¼šç»™æ‚¨é™ä½å¾ˆå¤šå‹åŠ›ï¼å¦‚æœæˆ‘å†™äº†'answr'è€Œä¸æ˜¯'answer'ï¼Œç¼–è¯‘å™¨å°±ä¼šæœ‰å…³äºå®ƒçš„ _nice_ æŠ¥é”™ï¼š

```
4 |     println!("Hello {}", answr);
  |                         ^^^^^ did you mean `answer`?
```

`println!`å®éœ€è¦ä¸€ä¸ª[æ ¼å¼å­—ç¬¦ä¸²{format string}](https://doc.rust-lang.org/std/fmt/index.html)å’Œç›¸åº”çš„ å€¼ ï¼›ç”¨çš„æ ¼å¼ä¸ Python 3 å¾ˆç±»ä¼¼ã€‚

å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å®æ˜¯`assert_eq!`ã€‚
å®ƒæ˜¯ Rust ç¨‹åºæµ‹è¯•æ—¶çš„ä¸»åŠ›ï¼›_æ–­è¨€{assert}_ ä¸­ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°å¿…é¡»ç›¸ç­‰ï¼Œå¦åˆ™å°±ä¼šè¿”å›ä¸€ä¸ª _panic{ææ…Œ}_ï¼Œç›¸å½“äºç¨‹åºå´©æºƒã€‚

```rust
// let2.rs
fn main() {
    let answer = 42;
    assert_eq!(answer,42);
}
```

ä¸Šé¢çš„ä»£ç æ˜¯ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºçš„ã€‚
ä½†æŠŠ 42 æ”¹ä¸º 40ï¼š

```
thread 'main' panicked at
'assertion failed: `(left == right)` (left: `42`, right: `40`)',
let2.rs:4
note: Run with `RUST_BACKTRACE=1` for a backtrace.
```

æˆ‘ä»¬å°±ä¼šå¾—åˆ° rust ä¸­çš„ç¬¬ä¸€ä¸ª _è¿è¡Œæ—¶é”™è¯¯_ ã€‚

## å¾ªç¯å’Œæ¡ä»¶è¯­å¥

æ‰€æœ‰æœ‰è¶£çš„äº‹æƒ…éƒ½å¯ä»¥è¿›è¡Œé‡å¤:

```rust
// for1.rs
fn main() {
    for i in 0..5 {
        println!("Hello {}", i);
    }
}
```

ä¸Šæ–‡çš„ _èŒƒå›´{range}_ ä¸­å¹¶ä¸åŒ…æ‹¬ **5**ï¼Œæ‰€ä»¥`i`çš„èŒƒå›´æ˜¯ **0 åˆ° 4**ã€‚
å¯¹äºéœ€è¦æŠŠæ•°ç»„ç­‰å†…å®¹ä» 0 å¼€å§‹è¿›è¡Œ _ç´¢å¼•{indexes}_ çš„è¯­è¨€è¿™ä¹ˆä½¿ç”¨å¾ˆæ–¹ä¾¿ã€‚

æœ‰è¶£çš„äº‹æƒ…ä¹Ÿå¾— _æŒ‰æ¡ä»¶{conditionally}_ è¿›è¡Œï¼š

```rust
// for2.rs
fn main() {
    for i in 0..5 {
        if i % 2 == 0 {
            println!("even {}", i);
        } else {
            println!("odd {}", i);
        }
    }
}
```

```
even 0
odd 1
even 2
odd 3
even 4
```

ä¸Šé¢çš„ä»£ç è¡¨ç¤ºï¼Œå¦‚æœ`i`èƒ½è¢« 2 æ•´é™¤ï¼Œ`i % 2`å°±ç­‰äº 0ã€‚
Rust ä½¿ç”¨ C é£æ ¼çš„æ“ä½œç¬¦ï¼Œæ¡ä»¶å‘¨å›´æ²¡æœ‰æ‹¬å·ï¼Œè¿™å’Œ Go å¾ˆç›¸åƒã€‚
ä½†æ˜¯åœ¨æ¡ä»¶åé¢å¿…é¡»è¦è·ŸèŠ±æ‹¬å·è¡¨ç¤ºä»£ç å—ã€‚

ç­‰ä»·ä¸”æ›´æœ‰è¶£çš„å†™æ³•ï¼š

```rust
// for3.rs
fn main() {
    for i in 0..5 {
        let even_odd = if i % 2 == 0 {"even"} else {"odd"};
        println!("{} {}", even_odd, i);
    }
}
```

ä¼ ç»Ÿä¸Šï¼Œç¼–ç¨‹è¯­è¨€æœ‰ _è¯­å¥{statements}_ (`if`) å’Œ _è¡¨è¾¾å¼{expressions}_ (`1 + i`)ã€‚
åœ¨ rust é‡Œï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸œè¥¿éƒ½æœ‰ä¸€ä¸ªå€¼ï¼Œä¸”å¯ä»¥åšä¸ºè¡¨è¾¾å¼ã€‚
å°±ä¸éœ€è¦ç”¨è¶…ä¸‘çš„ C 'ä¸‰å…ƒæ“ä½œç¬¦'`i % 2 == 0?"even": "odd"`ã€‚

âš ï¸ è¿™ç±»ä»£ç å—ä¸­æ²¡æœ‰åˆ†å·(åƒ`{"even"} else {"odd"}`è¿™æ ·çš„)ã€‚

## å¼€å§‹å †ç§¯æœ¨å§

è®¡ç®—æœºå¾ˆæ“…é•¿è®¡ç®—ã€‚
ä¸‹é¢æˆ‘ä»¬å°è¯•å¯¹ä» 0 åˆ° 4 çš„æ‰€æœ‰æ•°å­—è¿›è¡Œä¸€æ¬¡ç´¯åŠ ï¼š

```rust
// add1.rs
fn main() {
    let sum = 0;
    for i in 0..5 {
        sum += i;
    }
    println!("sum is {}", sum);
}
```

ä½†ç¼–è¯‘å¤±è´¥äº†ï¼š

```
error[E0384]: re-assignment of immutable variable `sum`
  --> add1.rs:5:9
3 |     let sum = 0;
  |         --- first assignment to `sum`
4 |     for i in 0..5 {
5 |         sum += i;
  |         ^^^^^^^^ re-assignment of immutable variable
```

`ä¸å¯å˜{Immutable}`ï¼Ÿä¸€ä¸ªå˜é‡å±…ç„¶ä¸èƒ½ _å˜{vary}_ï¼Ÿå¯¹ï¼`let`å£°æ˜æ—¶ï¼Œé»˜è®¤å˜é‡åªèƒ½èµ‹å€¼ã€‚
ä½†æ˜¯å¦‚æœæ·»åŠ é­”æ³•è¯`mut` (_è¯·_ è®©å˜é‡å¯å˜) å°±å¯ä»¥å®ç°å¯¹å˜é‡çš„æ”¹å˜ï¼š

```rust
// add2.rs
fn main() {
    let mut sum = 0;
    for i in 0..5 {
        sum += i;
    }
    println!("sum is {}", sum);
}
```

å…¶ä»–è¯­è¨€ä½¿ç”¨çš„äººï¼Œå°±ä¼šæ„Ÿåˆ°è´¹è§£ï¼Œåœ¨ä»–ä»¬çœ‹æ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹å˜é‡å°±æ˜¯å¯å˜çš„ã€‚
å˜é‡çš„äº§ç”Ÿæ˜¯ï¼Œåœ¨è¿è¡Œæ—¶è¢«åˆ†é…äº†ä¸€ä¸ªè®¡ç®—å€¼â€”â€”è€Œä¸æ˜¯ä¸€ä¸ª _å¸¸é‡{constant}_ ã€‚
åœ¨æ•°å­¦ä¸­ä¹Ÿæœ‰åŒæ ·çš„è¯´æ³•ï¼Œå°±åƒæˆ‘ä»¬è¯´â€œè®© n æ˜¯ S ä¸­æœ€å¤§çš„æ•°â€ã€‚

å£°æ˜å˜é‡é»˜è®¤ _åªè¯»_ æ˜¯æœ‰åŸå› çš„ã€‚
åœ¨æ›´å¤§çš„ç¨‹åºä¸­ï¼Œå¾ˆéš¾è·Ÿè¸ªæ­£åœ¨å†™å…¥çš„ä»£ç ã€‚
æ‰€ä»¥ Rust æ˜¯ä¸ºäº†èƒ½å¤Ÿæ˜ç¡®åœ°è¡¨ç°å‡ºå˜é‡çš„å¯å˜æ€§ ('èƒ½å†™å…¥')ã€‚
Rust è¯­è¨€ä¸­æœ‰å¾ˆå¤šèªæ˜ä¹‹å¤„ï¼Œå®ƒä¸ä¼šéšè—ä»»ä½•ä¸œè¥¿ã€‚

Rust æ—¢æ˜¯é™æ€ç±»å‹åˆæ˜¯å¼ºç±»å‹ï¼Œè¿™ç‚¹å¸¸æ•´æ··æ·†ï¼Œé‚£å°±æƒ³æƒ³ C (é™æ€ä½†å¼±ç±»å‹) å’Œ Python (åŠ¨æ€ä½†å¼ºç±»å‹)ã€‚
åœ¨é™æ€ç±»å‹ä¸­ï¼Œç±»å‹åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥ï¼Œè€ŒåŠ¨æ€ç±»å‹ä»…åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“ã€‚

ä½†æ˜¯ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œæ„Ÿè§‰ Rust åè€ŒæŠŠè¿™äº›ç±»å‹ _è—{hiding}_ äº†èµ·æ¥ã€‚
ç©¶ç«Ÿ`i`æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ
ç¼–è¯‘å™¨å¯ä»¥ä» 0 å¼€å§‹è¿›è¡Œ _ç±»å‹æ¨æ–­_ å¹¶å¾—å‡º`i32` (å››å­—èŠ‚æœ‰ç¬¦å·æ•´æ•°)ã€‚

è®©æˆ‘ä»¬æ”¹ä¸€ä¸‹ï¼ŒæŠŠ`0`æ”¹æˆ`0.0`ã€‚ç„¶åå°±å¾—åˆ°äº†ä¸ªæŠ¥é”™ï¼š

```
error[E0277]: the trait bound `{float}: std::ops::AddAssign<{integer}>` is not satisfied
  --> add3.rs:5:9
  |
5 |         sum += i;
  |         ^^^^^^^^ the trait `std::ops::AddAssign<{integer}>` is not implemented for `{float}`
  |
```

å¥½äº†ï¼Œè½»æ¾çš„é‚£æ®µè¿‡å»äº†ï¼šè¿™æŠ¥é”™ä»€ä¹ˆæ„æ€ï¼Ÿ
æ¯ä¸ªæ“ä½œç¬¦ (åƒ `+=` ) å¯¹åº”ä¸€ä¸ª _ç‰¹æ€§{trait}_ ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œå¿…é¡»ä¸ºæ¯ç§å…·ä½“çš„ç±»å‹è¿›è¡Œå®ç°ã€‚
ç¨åæˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£ traitï¼Œä½†æ˜¯è¿™é‡Œæ‚¨éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ`é™„åŠ èµ‹å€¼{AddAssign}`æ˜¯å®ç°`+=`è¿ç®—ç¬¦çš„ trait åç§°ï¼ŒæŠ¥é”™æ˜¯è¯´æµ®ç‚¹æ•°æ²¡æœ‰å®ç°æ•´æ•°çš„`+=`è¿ç®—ç¬¦ã€‚
(è¿ç®—ç¬¦ trait çš„å®Œæ•´åˆ—è¡¨[åœ¨è¿™é‡Œ](https://doc.rust-lang.org/std/ops/index.html))

åˆä¸€æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒRust å–œæ¬¢å¼ æ‰¬, å®ƒä¸ä¼šæ‚„æ‚„æŠŠé‚£ä¸ªæ•´æ•°è½¬æ¢æˆæµ®ç‚¹æ•°ã€‚

æ‰€ä»¥æˆ‘ä»¬å¾—æ˜¾å¼åœ°æŠŠå€¼çš„ç±»å‹ _è½¬æ¢_ ä¸ºæµ®ç‚¹æ•°ã€‚

```rust
// add3.rs
fn main() {
    let mut sum = 0.0;
    for i in 0..5 {
        sum += i as f64;
    }
    println!("sum is {}", sum);
}
```

## ç¡®åˆ‡çš„å‡½æ•°ç±»å‹

_å‡½æ•°{Functions}_ çš„è¿”å›å€¼è¿™ä¸€ç‰‡ï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šä¸ºä½ ç±»å‹æ¨æ–­çš„ã€‚

äº‹å®ä¸Šè¿™ä¸ªå†³å®šæ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ï¼Œè‡ªæ‰“ Haskell è¯­è¨€å¼€å§‹å°±è¿™æ ·äº†(è¯¥è¯­è¨€æ‹¥æœ‰å¼ºå¤§çš„ç±»å‹æ¨æ–­ï¼Œå‡ ä¹å°±æ²¡æœ‰æ˜¾å¼çš„ç±»å‹åç§°)ã€‚
è‰¯å¥½çš„ Haskell é£æ ¼ï¼Œå°±æ˜¯å‡½æ•° + æ˜¾å¼ç±»å‹ç­¾åã€‚
Rust å°±éœ€è¦çš„è¿™æ ·çš„ã€‚

æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼š

```rust
// fun1.rs

fn sqr(x: f64) -> f64 {
    return x * x;
}

fn main() {
    let res = sqr(2.0);
    println!("square is {}", res);
}
```

å‚æ•°å£°æ˜æ—¶ Rust åˆå›åˆ°ä¼ ç»Ÿçš„é£æ ¼ä¸Šäº†ï¼Œå…¶ä¸­ç±»å‹è·Ÿåœ¨åç§°åé¢ã€‚
å°±åƒ Pascal ç­‰ Algol æ´¾ç”Ÿè¯­è¨€ã€‚

å†æ¬¡ï¼Œå¦‚æœæ²¡æœ‰æ•´æ•°åˆ°æµ®ç‚¹æ•°çš„è½¬æ¢â€”â€”å¦‚æœä½ ç”¨'2'ç›´æ¥ä»£æ›¿`2.0`ï¼Œé‚£æˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ˜ç¡®çš„æŠ¥é”™ï¼š

```
8 |     let res = sqr(2);
  |                   ^ expected f64, found integral variable
  |
```

ä½ ä¸å¤ªèƒ½çœ‹åˆ°å‡½æ•°ç”¨`return`å£°æ˜è¿”å›å€¼ã€‚
å¾ˆå¤šæ—¶å€™ï¼Œä¼šåƒè¿™æ ·ç¼–å†™ï¼š

```rust
fn sqr(x: f64) -> f64 {
    x * x
}
```

è¿™æ˜¯å› ä¸ºå‡½æ•°çš„ä¸»ä½“(`{}`å†…éƒ¨)åŒ…å« _æœ€åå€¼è¡¨è¾¾å¼_ ï¼Œå°±åƒ if-as-an-expression ã€‚

ç”±äºåˆ†å·æ˜¯ç”±äººçš„æ‰‹æŒ‡åŠè‡ªåŠ¨æ’å…¥çš„ï¼Œæ‰€ä»¥ä½ æŠŠå®ƒåŠ 
åœ¨ _æœ€åå€¼è¡¨è¾¾å¼_ æœ«å°¾ï¼Œå°±ä¼šæœ‰ä¸‹é¢çš„æŠ¥é”™ï¼š

```
  |
3 | fn sqr(x: f64) -> f64 {
  |                       ^ expected f64, found ()
  |
  = note: expected type `f64`
  = note:    found type `()`
  help: consider removing this semicolon:
   --> fun2.rs:4:8
  |
4 |     x * x;
  |       ^
```

`()`ç±»å‹æ˜¯ç©ºç±»å‹ï¼Œnadaï¼Œ`æ— æ•ˆ{void}`ï¼Œ0ï¼Œç©ºï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰çš„æ„æ€ã€‚
Rust ä¸­ä¸€åˆ‡éƒ½æœ‰ä¸ªå€¼ï¼Œä½†æœ‰æ—¶å®ƒå°±æ˜¯ç©ºã€‚
ç¼–è¯‘å™¨èƒ½æ£€æµ‹è¿™ä¸ªå¸¸è§é”™è¯¯ï¼Œå¹¶åˆ‡å®çš„å¸®åŠ©ä½ ï¼Œ(æ¯ä¸ªåœ¨ C++ ç¼–è¯‘å™¨ä¸ŠèŠ±è¿‡æ—¶é—´çš„äººéƒ½çŸ¥é“ï¼Œè¿™å¯æ˜¯ä¸ª _è¦æ­»è¦æ­»çš„æƒ…å†µ{damn unusual}_ )ã€‚

âš ï¸ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è¦è¿”å›å€¼ï¼Œå°±ä¸èƒ½åŠ  `åˆ†å·{;}`

æ²¡ return è¡¨è¾¾é£æ ¼çš„å‡ ä¸ªä¾‹å­:

```rust
// è¿”å›ï¼Œä¸€ä¸ªæµ®ç‚¹æ•°çš„ç»å¯¹å€¼å‡½æ•°
fn abs(x: f64) -> f64 {
    if x > 0.0 {
        x
    } else {
        -x
    }
}

// ç¡®ä¿ï¼Œè¯¥æ•°å­—ï¼Œå®šç„¶åœ¨ç»™äºˆçš„èŒƒå›´å†…
fn clamp(x: f64, x1: f64, x2: f64) -> f64 {
    if x < x1 {
        x1
    } else if x > x2 {
        x2
    } else {
        x
    }
}
```

ä½¿ç”¨`return`æ²¡æœ‰é”™ï¼Œä½†æ²¡æœ‰å®ƒä»£ç ä¼šæ›´æ•´æ´ã€‚
ä½†æ˜¯å¯¹äºéœ€è¦å‡½æ•° _æå‰è¿”å›å€¼_ ï¼Œä½ ä»éœ€è¦ä½¿ç”¨`return`ã€‚

æœ‰äº›æ“ä½œå°±å¯ä»¥ä¼˜é›…çš„è¡¨è¾¾ _é€’å½’{recursively}_:

```rust
fn factorial(n: u64) -> u64 {
    if n == 0 {
        1
    } else {
        n * factorial(n-1)
    }
}
```

ç¬¬ä¸€æ¬¡æ¥è§¦å¯èƒ½æœ‰äº›å¥‡æ€ªï¼Œæœ€å¥½å°±æ˜¯ä¸‹æ¥ç”¨ç¬”å’Œçº¸å†™ç‚¹ä¾‹å­ã€‚å½“ç„¶è¿™å¹¶ä¸æ˜¯æœ€ _é«˜æ•ˆ_ çš„æ–¹å¼ã€‚

å€¼ä¹Ÿå¯ä»¥é€šè¿‡ _å¼•ç”¨{reference}_ çš„æ–¹å¼ä¼ é€’ã€‚å¼•ç”¨ç”±`&`åˆ›å»ºï¼Œå¹¶ç”±`*` _è§£å¼•ç”¨{dereferenced}_ ã€‚

```rust
fn by_ref(x: &i32) -> i32{
    *x + 1
}

fn main() {
    let i = 10;
    let res1 = by_ref(&i);
    let res2 = by_ref(&41);
    println!("{} {}", res1,res2);
}
// 11 42
```

å¦‚æœä½ æƒ³è®©ä¸€ä¸ªå‡½æ•°æ¥ä¿®æ”¹å®ƒçš„ä¸€ä¸ªå‚æ•°ï¼Œé‚£å°±è¾“å…¥ _å¯å˜å¼•ç”¨{mutable references}_ï¼š

```rust
// fun4.rs

fn modifies(x: &mut f64) {
    *x = 1.0;
}

fn main() {
    let mut res = 0.0;
    modifies(&mut res);
    println!("res is {}", res);
}
```

ä¸å…¶è¯´æ˜¯ C++ è¿™æ›´åƒæ˜¯ C ã€‚ä½ å¾—ç¡®åˆ‡çš„å¼•ç”¨æ¥ä¼ é€’å‚æ•° (åŠ ä¸Š`&`) å¹¶ç”¨`*` _è§£å¼•ç”¨_ ã€‚
ç„¶åç»™ä¸€ä¸ª`mut`ï¼Œå› ä¸ºå®ƒä¸æ˜¯é»˜è®¤å¯å˜çš„ã€‚(æˆ‘ä¸€ç›´è§‰å¾—ä¸ C ç›¸æ¯”, C++ å¼•ç”¨å¤ªå®¹æ˜“å¿˜)

åŸºæœ¬ä¸Šï¼Œè¿™é‡Œ Rust å°±å¸¦æ¥äº†äº› _æ‘©æ“¦{friction}_ ã€‚
å®ƒæ²¡æœ‰é‚£ä¹ˆå·§å¦™åœ°æ¨åŠ¨å‡½æ•°ç›´æ¥è¿”å›å€¼ã€‚
å·§çš„æ˜¯, rust æœ‰å¼ºåŠ›çš„æ–¹å¼è¡¨è¾¾â€œæ“ä½œæˆåŠŸ,ç»“æœåœ¨è¿™é‡Œâ€ã€‚
æ‰€ä»¥`&mut`ä¸éœ€è¦ç”¨çš„é‚£ä¹ˆé¢‘ç¹ã€‚
å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤§å¯¹è±¡è¿˜ä¸æƒ³å¤åˆ¶å®ƒæ—¶ï¼Œä¼ é€’å¼•ç”¨å°±å¾ˆé‡è¦äº†ã€‚

å½“ä½ çœŸçš„æƒ³æ”¹å˜å˜é‡çš„ç±»å‹æ—¶ï¼Œå°±ç”¨å˜é‡ååŠ ä¸Šç±»å‹çš„æ ·å¼ï¼Œè¿™åŒæ ·é€‚ç”¨äº`let`ï¼š

```rust
let bigint: i64 = 0;
```

## å­¦ä¼šæ‰¾åˆ°æ•‘å‘½ç¨»è‰

ç°åœ¨æ˜¯æ—¶å€™å¼€å§‹ä½¿ç”¨æ–‡æ¡£äº†ã€‚
å®ƒå·²ç»å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Šäº†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`rustup doc --std`åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å®ƒã€‚

çœ‹åˆ°é¡¶éƒ¨çš„ _æœç´¢_ äº†å—ï¼Œå®ƒä¼šæˆä¸ºä½ çš„ä¼™ä¼´ï¼›å®ƒå®Œå…¨ç¦»çº¿è¿è¡Œã€‚

å‡è®¾æˆ‘ä»¬æƒ³çŸ¥é“æ•°å­¦å‡½æ•°åœ¨å“ªé‡Œï¼Œæ‰€ä»¥æœç´¢â€œcosâ€ã€‚
å‰ä¸¤ä¸ªåŒ¹é…æ˜¾ç¤ºï¼Œå®ƒæœ‰ä¸ºå•ç²¾åº¦å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°å­—çš„å®šä¹‰ã€‚
ä½œä¸ºä¸€ç§æ–¹æ³•ï¼Œå®ƒå®šä¹‰åœ¨ _å€¼æœ¬èº«{value itself}_ ä¹‹ä¸Šï¼Œåƒè¿™æ ·ï¼š

```rust
let pi: f64 = 3.1416;
let x = pi/2.0;
let cosine = x.cos();
```

ç»“æœè¿‘ä¹äºé›¶ï¼›æ˜¾ç„¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´æƒå¨çš„'pi'ï¼

(ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ˜ç¡®çš„`f64`ç±»å‹ï¼Ÿå› ä¸ºæ²¡æœ‰å®ƒï¼Œ*3.1416*å¸¸æ•°å¯ä»¥æ˜¯`f32`æˆ–`f64`ç±»å‹ï¼Œè€Œè¿™äº›éƒ½å¤§æœ‰ä¸åŒã€‚)

è®©æˆ‘ä»¬å¼•ç”¨`cos`çš„ä¾‹å­ï¼Œå†™ä¸€ä¸ªå®Œæ•´çš„ç¨‹åº(`assert_eq!`çš„è¡¨äº²æˆš`assert!`ï¼›ä¼ å…¥è¡¨è¾¾å¼å¿…é¡»æ­£ç¡®)ã€‚

```rust
fn main() {
    let x = 2.0 * std::f64::consts::PI;

    let abs_difference = (x.cos() - 1.0).abs();

    assert!(abs_difference < 1e-10);
}
```

`std::f64::consts::PI`ä¹Ÿå¿’é•¿äº†ï¼
`::`ä¸åœ¨ c++ ä¸­æ„æ€åŸºæœ¬ç›¸åŒï¼Œ(åœ¨å…¶ä»–è¯­è¨€é€šå¸¸ä½¿ç”¨".")â€”â€”è¿™æ˜¯ä¸ª _å®Œå…¨åˆæ ¼çš„åå­—_ ã€‚
åœ¨æ–‡æ¡£æœç´¢'PI'åï¼Œæœç´¢ç»“æœä¸­ç¬¬äºŒä¸ªåŒ¹é…å°±æ˜¯å®ƒçš„å…¨åã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ Rust å°é¡¹ç›®ä¸€ç›´æŠ›å¼€`import`å’Œ`exclude`è¿™äº›ï¼Œæ˜¯å› ä¸ºå®ƒä»¬ä¼šè®©è®¨è®º"Hello World"ç¨‹åºæ…¢ä¸‹æ¥ã€‚
ä¸‹é¢æˆ‘ä»¬ç”¨`use`å£°æ˜è®©è¿™ä¸ªç¨‹åºå¯è¯»æ€§æ›´å¼ºï¼š

```rust
use std::f64::consts;

fn main() {
    let x = 2.0 * consts::PI;

    let abs_difference = (x.cos() - 1.0).abs();

    assert!(abs_difference < 1e-10);
}
```

ä¸ºä»€ä¹ˆç°åœ¨æˆ‘ä»¬ä¸éœ€è¦è¿™æ ·åšäº†ï¼Ÿ
æ˜¯å› ä¸º Rust çš„*prelude*åœ¨èµ·ä½œç”¨ï¼Œä½¿è®¸å¤šåŸºæœ¬åŠŸèƒ½æ— éœ€æ˜¾å¼ `use`è¯­å¥ã€‚

## æ•°ç»„å’Œåˆ‡ç‰‡

æ‰€æœ‰é™æ€ç±»å‹çš„è¯­è¨€éƒ½æœ‰ _æ•°ç»„_ï¼Œå®ƒæ˜¯å†…å­˜é‡Œé¦–ä½ç›¸è¿çš„ä¸€ä¸²å€¼ã€‚æ•°ç»„çš„ _ç´¢å¼•_ ä»é›¶å¼€å§‹ï¼š

```rust
// array1.rs
fn main() {
    let arr = [10, 20, 30, 40];
    let first = arr[0];
    println!("first {}", first);

    for i in 0..4 {
        println!("[{}] = {}", i,arr[i]);
    }
    println!("length {}", arr.len());
}
```

è¾“å‡ºæ˜¯ï¼š

```
first 10
[0] = 10
[1] = 20
[2] = 30
[3] = 40
length 4
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRust _æ˜ç¡®_ çŸ¥é“æ•°ç»„æœ‰å¤šå¤§ï¼Œå¦‚æœä½ å°è¯•è®¿é—®`arr[4]`ï¼Œå°±ä¼šæœ‰ä¸€ä¸ª _ç¼–è¯‘é”™è¯¯_ ã€‚

å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€çš„è¿‡ç¨‹å¸¸åŒ…å« _å¿˜å´_ å·²ç»ä¼šçš„è¯­è¨€çš„æ€ç»´ä¹ æƒ¯ï¼›å¦‚æœä½ æ˜¯ä¸€ä¸ª Pythonistaï¼Œé‚£ä¹ˆä½ å¯èƒ½è®¤ä¸ºè¿™äº›æ‹¬å·æ˜¯`list`ã€‚
ä¹‹åæˆ‘ä»¬ä¼šå­¦ä¹  Rust ä¸­çš„`list`ï¼Œä½†æ•°ç»„ä¸æ˜¯ä½ æƒ³çš„é‚£æ ·; ä»–ä»¬ _å¤§å°å›ºå®š_ ã€‚
ä¹Ÿä¼šæ˜¯ _å¯å˜çš„_ (å¦‚æœæˆ‘ä»¬çš„è¯·æ±‚æ­£ç¡®)ï¼Œä½†ä½ ä¸èƒ½æ·»åŠ æ–°çš„å…ƒç´ ã€‚

Rust ä¸­ä¸å¸¸ä½¿ç”¨æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„ç±»å‹åŒ…å«ä»–ä»¬å¤§å°ã€‚
ç¤ºä¾‹ä¸­çš„æ•°ç»„ç±»å‹æ˜¯`[i32;4]`ï¼›`[10,20]`ç±»å‹å°±æ˜¯`[i32;2]`ç­‰ç­‰ï¼šä»–ä»¬æ˜¯ _ä¸åŒç±»å‹_ ã€‚
æ‰€ä»¥ä»–ä»¬ä½œä¸ºå‡½æ•°å‚æ•°æ˜¯ä»¶éº»çƒ¦äº‹ã€‚

å¸¸ç”¨çš„æ˜¯ _åˆ‡ç‰‡_ ã€‚
ä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯ä¸€ä¸ªåŸºæœ¬æ•°ç»„çš„ _å¿«ç…§_ ã€‚
å®ƒä»¬çš„è¡Œä¸ºå¾ˆåƒä¸€ä¸ªæ•°ç»„ï¼Œä¸” _å·²çŸ¥å¤§å°_ ï¼Œä¸åƒ C æŒ‡é’ˆé‚£ç§å±é™©çš„ä¸œä¸œã€‚

æ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„äº‹æƒ…â€”â€”ä¸€ä¸ªåˆ‡ç‰‡ç±»å‹å¦‚ä½•å†™ï¼Œä»¥åŠå‘ä¼ é€’å‡½æ•°å‚æ•°æ—¶ä½ å¿…é¡»ä½¿ç”¨`&`ã€‚

```rust
// array2.rs
// è¯»ä½œ as: i32åˆ‡ç‰‡
fn sum(values: &[i32]) -> i32 {
    let mut res = 0;
    for i in 0..values.len() {
        res += values[i]
    }
    res
}

fn main() {
    let arr = [10,20,30,40];
    // çœ‹ç€è¿™é‡Œçš„ &
    let res = sum(&arr);
    println!("sum {}", res);
}
```
å…ˆå¿½ç•¥`sum`å‡½æ•°ï¼Œçœ‹çœ‹`&[i32]`ã€‚
rust æ•°ç»„å’Œåˆ‡ç‰‡ä¹‹é—´çš„å…³ç³»ç±»ä¼¼äº C æ•°ç»„å’ŒæŒ‡é’ˆ ä¹‹é—´çš„å…³ç³»ï¼Œä½†å­˜åœ¨ä¸¤ä¸ªé‡è¦çš„åŒºåˆ«:
- rust çš„åˆ‡ç‰‡ä¼šè·Ÿè¸ªå®ƒä»¬çš„å¤§å°(å¦‚æœä½  å°è¯•è®¿é—®è¿™ä¸ªå¤§å°ä¹‹å¤– ä¼š _panic_)
- å¹¶ä¸”æƒ³æŠŠæ•°ç»„ä½œä¸ºä¸€ä¸ªåˆ‡ç‰‡ä¼ é€’ï¼Œä½ å¿…é¡»æ˜ç¡®åœ°ä½¿ç”¨`&`æ“ä½œç¬¦ã€‚

C ç¨‹åºå‘˜ä¼šæŠŠ`&`è¯»ä½œ"å–åœ°å€ç¬¦"ï¼Œè€Œ rust ç¨‹åºå‘˜æŠŠå®ƒè¯»ä½œ _å€Ÿç”¨{borrow}_ã€‚
è¿™å°†æ˜¯å­¦ä¹ æ—¶ rust çš„å…³é”®è¯ã€‚
å€Ÿç”¨æ˜¯ç¼–ç¨‹ä¸­å¸¸è§çš„ä¸€ç§æ¨¡å¼ï¼›æ¯å½“ä½ é€šè¿‡å¼•ç”¨ä¼ é€’ä¸€äº›å€¼(åœ¨åŠ¨æ€è¯­è¨€ä¸­å‡ ä¹éƒ½ä¼šå‘ç”Ÿ)æˆ– åœ¨ C ä¸­ä¼ é€’æŒ‡é’ˆæ—¶ï¼Œè¢« _å€Ÿç”¨_ çš„ä¸œè¥¿åŸå§‹æ‰€æœ‰è€…ä»æŒæœ‰æ‰€æœ‰æƒã€‚

## åˆ‡å’Œå‰²

ä¸€èˆ¬æƒ…å†µä¸‹ä½ å¹¶ä¸èƒ½ç”¨`{}`æ‰“å°å‡ºä¸€ä¸ªæ•°ç»„ï¼Œä½†å¯ä»¥ç”¨`{:?}`åšä¸€ä¸ª _debug_ æ€§è´¨çš„æ‰“å°ã€‚

```rust
// array3.rs
fn main() {
    let ints = [1, 2, 3];
    let floats = [1.1, 2.1, 3.1];
    let strings = ["hello", "world"];
    let ints_ints = [[1, 2], [10, 20]];
    println!("ints {:?}", ints);
    println!("floats {:?}", floats);
    println!("strings {:?}", strings);
    println!("ints_ints {:?}", ints_ints);
}
```

ä¼šå¾—åˆ°è¿”å›å¦‚ä¸‹ï¼š

```
ints [1, 2, 3]
floats [1.1, 2.1, 3.1]
strings ["hello", "world"]
ints_ints [[1, 2], [10, 20]]
```

æ‰€ä»¥ï¼Œæ•°ç»„å¥—æ•°ç»„æ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯æ•°ç»„åŒ…æ‹¬å†…å®¹ _åªèƒ½æœ‰ä¸€ä¸ªç±»å‹_ã€‚
æ•°ç»„ä¸­çš„å€¼åœ¨å†…å­˜ä¸­æ’åˆ—åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿ä»–ä»¬ _é_ å¸¸é«˜æ•ˆåœ°è®¿é—®ã€‚

å¦‚æœä½ å¯¹è¿™äº›å˜é‡å®é™…çš„ç±»å‹æ„Ÿåˆ°å¥½å¥‡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°æŠ€å·§ã€‚
å°±ç”¨ä¸€ä¸ªä½ æ˜çŸ¥é“ä¼šé”™è¯¯çš„æ˜¾å¼ç±»å‹ï¼Œæ¥å£°æ˜ä¸€ä¸ªå˜é‡ï¼š

```rust
let var: () = [1.1, 1.2];
```

ä¸‹é¢æ˜¯é”™è¯¯ä¿¡æ¯:

```
3 |     let var: () = [1.1, 1.2];
  |                   ^^^^^^^^^^ expected (), found array of 2 elements
  |
  = note: expected type `()`
  = note:    found type `[{float}; 2]`
```

(`{float}`æ„æ€æ˜¯"ä¸€äº›è¿˜æ²¡å®Œå…¨æŒ‡å®šçš„æµ®ç‚¹æ•°ç±»å‹")

åˆ‡ç‰‡ä¼šç»™ä½  _ç›¸åŒ_ æ•°ç»„çš„ä¸åŒ _è§†è§’_ :

```rust
// slice1.rs
fn main() {
    let ints = [1, 2, 3, 4, 5];
    let slice1 = &ints[0..2];
    let slice2 = &ints[1..];  // å¼€æ”¾å¼èŒƒå›´!

    println!("ints {:?}", ints);
    println!("slice1 {:?}", slice1);
    println!("slice2 {:?}", slice2);
}
```

```
ints [1, 2, 3, 4, 5]
slice1 [1, 2]
slice2 [2, 3, 4, 5]
```

è¿™ç§ç®€æ´çš„ç¬¦å·ï¼Œç±»ä¼¼äº Python çš„åˆ‡ç‰‡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«ï¼šæ•°æ®ä»æœªæœ‰è¿‡ä»»ä½•çš„å‰¯æœ¬ã€‚
è¿™äº› _åˆ‡ç‰‡_ éƒ½æ˜¯ `å€Ÿç”¨{borrow}` ä»–ä»¬è‡ªå·±çš„æ•°ç»„æ•°æ®ã€‚
å®ƒä»¬ä¸æ•°ç»„å…·æœ‰æ›´ç´§å¯†çš„å…³ç³»ï¼Œè€Œä¸” Rust èŠ±å¾ˆå¤šç²¾åŠ›æ¥ç¡®ä¿è¿™ç§å…³ç³»ä¸ä¼šè¢«ç ´åã€‚

## å¯é€‰ï¼ˆOptionalï¼‰å€¼

<!-- TODO: æ•´åˆ°è¿™é‡Œäº† -->
åˆ‡ç‰‡ï¼Œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œå¯ä»¥ _ç´¢å¼•_ã€‚
Rust åœ¨ç¼–è¯‘æ—¶çŸ¥é“æ•°ç»„çš„å¤§å°ï¼Œä½†åªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“åˆ†åˆ‡ç‰‡çš„å¤§å°ã€‚
æ‰€ä»¥`s[i]`åœ¨è¿è¡Œæ—¶ä¼šå¼•èµ·è¶…å‡ºç•Œé™çš„é”™è¯¯å’Œ _ææ…Œ{panic}_ã€‚
è¿™ä½ ä¸ä¼šæƒ³è¦ï¼Œè€Œä¸€ä¸ªå®‰å…¨å¯åŠ¨ä¸­æ­¢ ä¸ éå¸¸æ˜‚è´µçš„åˆ‡ç‰‡ ä¹‹é—´ä¹Ÿæœ‰æ‰€ä¸åŒã€‚
_æ— ä¸€ä¾‹å¤–_ã€‚

å†·é™ä¸‹ï¼Œå¤§æ‹›æ¥äº†ã€‚
ä½ ä¸èƒ½åœ¨æŸäº› try-block ä¸­åŒ…è£…å¯æ€•çš„é—®é¢˜ä»£ç ï¼Œç”¨æ¥"æ•è·é”™è¯¯" - è‡³å°‘ä¸æ˜¯ä½ æ¯å¤©éƒ½æƒ³ä½¿ç”¨çš„æ–¹å¼ã€‚
é‚£ä¹ˆ Rust å¦‚ä½•ä¿è¯å®‰å…¨?

æœ‰ä¸€ç§åˆ‡ç‰‡æ–¹æ³•`get`ï¼Œè¿™å¹¶ä¸ææ…Œ{panic}ã€‚
ä½†æ˜¯å®ƒè¿”å›äº†ä»€ä¹ˆ?

```rust
// slice2.rs
fn main() {
    let ints = [1, 2, 3, 4, 5];
    let slice = &ints;
    let first = slice.get(0);
    let last = slice.get(5);

    println!("first {:?}", first);
    println!("last {:?}", last);
}
// first Some(1)
// last None
```

`last`å¤±è´¥ (æˆ‘ä»¬å¿˜è®°äº†åŸºäºé›¶çš„ç´¢å¼•)ï¼Œä½†è¿”å›äº†ä¸€ä¸ªå«åš`None`çš„ä¸œè¥¿ã€‚`first`å¾ˆå¥½ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ª å€¼åŒ…è£…åœ¨`Some`ä¸­ã€‚æ¬¢è¿`Options`ç±»å‹!å®ƒå¯èƒ½æ˜¯`Some` _æˆ–è€…_ `None`ã€‚

è¿™`option w`ç±»å‹æœ‰ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•:

```rust
    println!("first {} {}", first.is_some(), first.is_none());
    println!("last {} {}", last.is_some(), last.is_none());
    println!("first value {}", first.unwrap());

// first true false
// last false true
// first value 1
```

å¦‚æœä½  _æ‰“å¼€{unwrap}_ `last`ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªææ…Œ{panic}ã€‚ä½†è‡³å°‘ä½ å¯ä»¥è°ƒç”¨`is_some` - å¦‚ç¤ºä¾‹ä¸­ï¼Œå¦‚æœé»˜è®¤ä½ æœ‰ä¸€ä¸ª æ²¡æœ‰å€¼çš„å˜é‡:

```rust
    let maybe_last = slice.get(5);
    let last = if maybe_last.is_some() {
        *maybe_last.unwrap()
    } else {
        -1
    };
```

æ³¨æ„`*` - `Some`å†…éƒ¨çš„ç²¾ç¡®ç±»å‹æ˜¯`&i32`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚æˆ‘ä»¬éœ€è¦è§£å¼•ç”¨å›åˆ°ä¸€ä¸ª`i32`çš„å€¼.

è¿™ç¹çï¼Œä¸€ä¸ªå¿«æ·æ–¹å¼æ˜¯`unwrap_or`, å¦‚æœè¿”å›çš„å€¼æ˜¯`None`çš„`Option`ç±»å‹ã€‚- ç±»å‹è¦åŒ¹é…ï¼Œå› `get`è¿”å›ä¸€ä¸ªå¼•ç”¨ã€‚æ‰€ä»¥ä½ å¿…é¡»å†™æˆ`&i32`ä¸`&-1`ã€‚æœ€åå†æ¬¡ä½¿ç”¨`*`è·å¾—`i32`ç±»å‹å€¼ã€‚

```rust
    let last = *slice.get(5).unwrap_or(&-1);
```

å¾ˆå®¹æ˜“æ¼å†™`&`ï¼Œä½†ä½ æœ‰ç¼–è¯‘å™¨çš„å¸®åŠ©ã€‚å¦‚æœå®ƒæ˜¯`-1`ï¼Œ`rustc` says 'expected &{integer}ï¼Œfound integral variable'ï¼Œç„¶åå‘Šè¯‰ä½ 'help: try`&-1`"ã€‚

ä½ å¯ä»¥æŠŠ`Option`æƒ³æˆä¸€ä¸ªå¯èƒ½åŒ…å«ä¸€ä¸ªå€¼çš„ ç›’å­ï¼Œæˆ–è€…ä»€ä¹ˆéƒ½æ²¡æœ‰ (`None`) (åœ¨ Haskellï¼Œå®ƒè¢«ç§°ä¸º`Maybe`)ã€‚å¯èƒ½åŒ…å« _ä»»ä½•_ å€¼ï¼Œå°±æ˜¯å®ƒçš„ _ç±»å‹è§„èŒƒ_ ã€‚è€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®Œæ•´çš„ç±»å‹æ˜¯`Option<&i32>`ï¼Œä½¿ç”¨ C ++ é£æ ¼çš„è¡¨ç¤º _æ³›å‹{generics}_ã€‚æ‰“å¼€è¿™ä¸ª ç›’å­å¯èƒ½ä¼šå¼•èµ·çˆ†ç‚¸ï¼Œä½†ä¸åƒè–›å®šè°”çš„çŒ«ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆçŸ¥é“å®ƒæ˜¯å¦åŒ…å«ä¸€ä¸ªå€¼ã€‚

åœ¨ Rust å‡½æ•°/æ–¹æ³•ä¸­ï¼Œè¿”å›è¿™äº›å¯èƒ½çš„ç›’å­(`Option`)ï¼Œæ˜¯éå¸¸å¸¸è§çš„ï¼Œæ‰€ä»¥å­¦ä¹ å¦‚ä½•èˆ’é€‚åœ°[ä½¿ç”¨å®ƒä»¬](https://doc.rust-lang.org/std/option/enum.Option.html)ã€‚

## å‘é‡

æˆ‘ä»¬å°†å†æ¬¡å›åˆ°åˆ‡ç‰‡æ–¹æ³•ï¼Œä½†é¦–å…ˆçœ‹çœ‹ï¼šå‘é‡{Vec}ã€‚è¿™äº›æ˜¯ _çµæ´»å¤§å°_ çš„æ•°ç»„ï¼Œå…¶è¡Œä¸ºå¾ˆåƒ Python çš„`List`å’Œ C++ çš„`std::vector`ã€‚äº‹å®ä¸Šï¼Œrust çš„`Vec`ä¼šæœ‰æ‰€ä¸åŒï¼Œä½ å¯ä»¥å°†é¢å¤–çš„å€¼é™„åŠ åˆ°ä¸€ä¸ªå‘é‡ä¸Šï¼Œå½“ç„¶æ³¨æ„ï¼Œå®ƒå¿…é¡»å£°æ˜ä¸ºå¯å˜çš„ã€‚

```rust
// vec1.rs
fn main() {
    let mut v = Vec::new();
    v.push(10);
    v.push(20);
    v.push(30);

    let first = v[0];  // åŒæ ·ï¼Œè¶…å‡ºèŒƒå›´ä¹Ÿä¼š panic
    let maybe_first = v.get(0);

    println!("v is {:?}", v);
    println!("first is {}", first);
    println!("maybe_first is {:?}", maybe_first);
}
// v is [10, 20, 30]
// first is 10
// maybe_first is Some(10)
```

ä¸€ä¸ªå¸¸è§çš„åˆå­¦è€…é”™è¯¯æ˜¯å¿˜è®°`mut`ï¼Œé‚£ä½ ä¼šå¾—åˆ°ä¸€ä¸ªæœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯:

```
3 |     let v = Vec::new();
  |         - use `mut v` here to make mutable
4 |     v.push(10);
  |     ^ cannot borrow mutably
```

å‘é‡å’Œåˆ‡ç‰‡ä¹‹é—´æœ‰éå¸¸å¯†åˆ‡çš„å…³ç³»:

```rust
// vec2.rs
fn dump(arr: &[i32]) {
    println!("arr is {:?}", arr);
}

fn main() {
    let mut v = Vec::new();
    v.push(10);
    v.push(20);
    v.push(30);

    dump(&v);

    let slice = &v[1..]; // <== è¿™ä¸ª &
    println!("slice is {:?}", slice);
}
```

é‚£ä¸ªå°å°çš„,å¾ˆé‡è¦çš„å€Ÿç”¨ç¬¦å·`&`æ˜¯ä¸ºäº† _è¿«ä½¿_ å‘é‡è¿›å…¥åˆ‡ç‰‡ã€‚ä¸”å®ƒæ˜¯å®Œå…¨è¯´å¾—é€šçš„ï¼Œå› ä¸ºå‘é‡ä¹Ÿåœ¨è§‚å¯Ÿç€ä¸€ä¸ªæœ‰å€¼çš„æ•°ç»„ï¼Œä¸åŒçš„æ˜¯è¯¥æ•°ç»„ä¸º _åŠ¨æ€åœ°_ åˆ†é…ã€‚

å¦‚æœä½ æ¥è‡ªä¸€ç§åŠ¨æ€çš„è¯­è¨€ï¼Œé‚£ä¹ˆç°åœ¨æ˜¯æ—¶å€™å¼€å§‹è®¨è®ºä¸‹äº†ã€‚åœ¨ç³»ç»Ÿè¯­è¨€ä¸­ï¼Œç¨‹åºå­˜å‚¨å™¨æœ‰ä¸¤ç§: æ ˆå’Œå †ã€‚åœ¨æ ˆä¸Šåˆ†é…æ•°æ®éå¸¸ç®€å•ï¼Œä½†æ˜¯æ ˆæ˜¯æœ‰é™çš„; é€šå¸¸æ˜¯ MB ä¸ºå•ä½ã€‚å †å¯ä»¥æ˜¯ GBï¼Œä½†æ˜¯åˆ†é…æˆæœ¬ç›¸å¯¹æ˜‚è´µï¼Œå¹¶ä¸”è¿™æ ·çš„å†…å­˜å¿…é¡»æ˜¯ä¹‹å _é‡Šæ”¾_ ã€‚åœ¨æ‰€è°“çš„'ç®¡ç†'è¯­è¨€ (å¦‚ javaï¼ŒGo å’Œæ‰€è°“çš„è„šæœ¬è¯­è¨€) è¿™äº›ç»†èŠ‚éƒ½éšè—åœ¨'ä¾¿åˆ©çš„å¸‚æ”¿å·¥ç¨‹'ç§° _åƒåœ¾æ”¶é›†å™¨_ ä¸­ã€‚ä¸€æ—¦ç³»ç»Ÿç¡®å®šæ•°æ®ä¸å†å¼•ç”¨çš„å…¶ä»–æ•°æ®ï¼Œå®ƒå°±ä¼šå›åˆ°å¯ç”¨å†…å­˜æ± ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼å¾—ä»˜å‡ºçš„ä»£ä»·ã€‚ç©æ ˆéå¸¸ä¸å®‰å…¨ï¼Œ
å› ä¸ºå¦‚æœä½ çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œåœ¨å½“å‰å‡½æ•°ä¸­è¦†ç›–è¿”å›åœ°å€ï¼Œé‚£ä¹ˆä½ è·ªäº†ã€‚

æˆ‘å†™çš„ç¬¬ä¸€ä¸ª C ç¨‹åºæ˜¯åœ¨ DOS PC ä¸Šï¼Œ
æŠ›å¼€ç”µè„‘æœ¬èº«ã€‚Unix ç³»ç»Ÿæ€»æ˜¯è¡¨ç°å¾—æ›´å¥½ï¼Œä¸”åªæœ‰ ä¼´éšä¸€ä¸ª _segfault_ çš„è¿›ç¨‹æ‰ä¼šæŒ‚æ‰
ã€‚ä¸ºä»€ä¹ˆè¿™æ¯” Rustï¼ˆæˆ– Goï¼‰ç¨‹åºææ…Œ{panic}æ›´ç³Ÿï¼Ÿ
å› ä¸º Rust ä¼šå½“åŸå§‹é—®é¢˜å‡ºç°äº†ï¼Œå°±ä¼šå‘ç”Ÿææ…Œ{panic}, è€Œä¸æ˜¯åƒä»¥å‰å›°æƒ‘ç¨‹åºæ€ä¹ˆå´©æºƒçš„ï¼Œå¹¶åƒæ‰ä½ æ‰€æœ‰çš„åŠŸè¯¾ã€‚

ææ…Œ{panic}å°±æ˜¯ _å†…å­˜å®‰å…¨_ ï¼Œå®ƒä»¬åœ¨ä»»ä½•éæ³•è®¿é—®å†…å­˜ä¹‹å‰å‘ç”Ÿã€‚è¿™æ˜¯ä¸€ä¸ª C ä¸­å¸¸è§çš„å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰å†…å­˜è®¿é—®éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸€ä¸ªç‹¡çŒ¾çš„æ”»å‡»è€…
å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¼±ç‚¹ã€‚

ææ…Œ{panic}æœ¬èº«å¬èµ·æ¥æ˜¯ç»æœ›çš„ï¼Œæ— è®¡åˆ’æ€§çš„ï¼Œä½† Rust çš„ææ…Œ{panic}æ˜¯ç»“æ„åŒ–çš„ - æ ˆçš„ _é‡Šæ”¾_ æ–¹å¼
ä¸å¼‚å¸¸(æŠ›å‡ºé”™è¯¯)æƒ…å†µå‘ç”Ÿæ—¶ç›¸åŒã€‚æ‰€æœ‰åˆ†é…çš„å¯¹è±¡éƒ½è¢«åˆ é™¤ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªå›æº¯ã€‚

åƒåœ¾æ”¶é›†çš„ç¼ºç‚¹ï¼Ÿ é¦–å…ˆæ˜¯å®ƒæ˜¯æµªè´¹å†…å­˜ï¼Œ
çœ‹çœ‹é‚£äº›å æœ‰é‡è¦åœ°ä½ï¼Œè¶Šæ¥è¶Šç»Ÿæ²»æˆ‘ä»¬ä¸–ç•Œçš„å°å‹åµŒå…¥å¼å¾®èŠ¯ç‰‡ï¼Œ
å…¶æ¬¡æ˜¯å®ƒä¼šåœ¨æœ€ç³Ÿç³•çš„æ—¶å€™å†³å®šè¿›è¡Œ _ç«‹å³_ æ¸…ç†
ã€‚ï¼ˆæœ‰ä¸ªå¦ˆå¦ˆçš„æ¯”å–»æ˜¯ï¼Œå¥¹æƒ³åœ¨ï¼Œä½ ä¸æ–°çš„æƒ…äººå¿«ä¹ç©è€æ—¶ï¼Œè¿›è¡Œæˆ¿é—´çš„æ‰“æ‰«
ï¼‰ã€‚è¿™äº›åµŒå…¥å¼ç³»ç»Ÿéœ€è¦å½“äº‹ç‰©å‘ç”Ÿæ—¶ï¼Œå¯¹å…¶åšå‡ºå“åº”
ï¼ˆ'å®æ—¶'ï¼‰ï¼Œå¹¶ä¸”ä¸èƒ½å®¹å¿è®¡åˆ’å¤–çš„
æ¸…æ´—ä¸¾åŠ¨ã€‚Roberto Ierusalimschyï¼ŒLua çš„é¦–å¸­è®¾è®¡å¸ˆï¼ˆæœ€ä¼˜é›…çš„åŠ¨æ€è¯­è¨€è®¾è®¡å¸ˆä¹‹ä¸€ï¼‰
è¯´ï¼Œä»–ä¸æƒ³é£æœºï¼Œæ˜¯
ä¾é åƒåœ¾æ”¶é›†è½¯ä»¶åœ¨é£ã€‚

å›åˆ° vectors ï¼šå½“ä¸€ä¸ª vectors è¢«ä¿®æ”¹æˆ–åˆ›å»ºæ—¶ï¼Œå®ƒç”±å †åˆ†é…å†…å­˜ï¼Œå¹¶å˜æˆ
è¯¥å†…å­˜çš„ _æ‹¥æœ‰è€…_ ã€‚åˆ‡ç‰‡ä» vectors çš„å†…å­˜ä¸­å€Ÿç”¨ã€‚
å½“ vectors æ­»äº¡æˆ– _drops_ æ—¶ï¼Œåˆ‡ç‰‡ä¹Ÿä¼šè·Ÿéš vectors çš„åŠ¨ä½œã€‚

## è¿­ä»£å™¨

æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢ï¼Œéƒ½æ²¡æœ‰æåŠçš„å…³é”®éƒ¨åˆ†ï¼Œä¹Ÿæ­£æ˜¯ rust çš„éš¾é¢˜ - è¿­ä»£å™¨.

ä¸€ä¸ªèŒƒå›´çš„ for å¾ªç¯ï¼Œæ˜¯åœ¨ä½¿ç”¨è¿­ä»£å™¨(`0..n`ï¼Œå…¶å®æ˜¯ç±»ä¼¼äº Python 3 çš„`range`åŠŸèƒ½)ã€‚

è¿­ä»£å™¨å¾ˆå®¹æ˜“å®šä¹‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª"å¯¹è±¡"ï¼Œå®ƒä½¿ç”¨`next`æ–¹æ³•è¿”å›ä¸€ä¸ª`Option`ã€‚åªè¦è¿™ä¸ªå€¼ä¸æ˜¯`None`ï¼Œæˆ‘ä»¬å°±ä¸€ç›´`next`ä¸‹å»:

```rust
// iter1.rs
fn main() {
    let mut iter = 0..3;
    assert_eq!(iter.next(), Some(0));
    assert_eq!(iter.next(), Some(1));
    assert_eq!(iter.next(), Some(2));
    assert_eq!(iter.next(), None);
}
```

è€Œè¿™æ­£æ˜¯`for var in iter {}`æ‰€åšçš„ã€‚

è¿™ä¼¼ä¹æ˜¯å®šä¹‰ for å¾ªç¯çš„ä¸€ç§ä½æ•ˆæ–¹å¼ï¼Œä½†æ˜¯`rustc`åœ¨å‘å¸ƒæ¨¡å¼ä¸­ä¼šè¿›è¡Œå˜æ€çš„ä¼˜åŒ–ï¼Œç›¸ä¿¡å®ƒä¼šå’Œ`while`å¾ªç¯ä¸€æ ·å¿«ã€‚

è¿™æ˜¯å¯¹æ•°ç»„è¿›è¡Œè¿­ä»£çš„ç¬¬ä¸€æ¬¡å°è¯•:

```rust
// iter2.rs
fn main() {
    let arr = [10, 20, 30];
    for i in arr {
        println!("{}", i);
    }
}
```

å¤±è´¥,ä½†æœ‰å¸®åŠ©å“Ÿ:

```
4 |     for i in arr {
  |     ^ the trait `std::iter::Iterator` is not implemented for `[{integer}; 3]`
  |
  = note: `[{integer}; 3]` is not an iterator; maybe try calling
   `.iter()` or a similar method
  = note: required by `std::iter::IntoIterator::into_iter`
```

æŒ‰ç…§`rustc`çš„å»ºè®®ï¼Œä¸‹é¢çš„ç¨‹åºæŒ‰é¢„æœŸå·¥ä½œ.

```rust
// iter3.rs
fn main() {
    let arr = [10, 20, 30];
    for i in arr.iter() {
        println!("{}", i);
    }

    // åˆ‡ç‰‡å°†éšå¼è½¬æ¢ä¸ºè¿­ä»£å™¨...
    let slice = &arr;
    for i in slice {
        println!("{}", i);
    }
}
```

å®é™…ä¸Šï¼Œè¿­ä»£æ•°ç»„æˆ–åˆ‡ç‰‡ï¼Œç”¨è¿™ç§æ–¹å¼æ¯”`for i in 0..slice.len() {}`æ•ˆç‡æ›´é«˜ï¼Œå› ä¸º Rust ä¸å¿…ç—´è¿·äºæ£€æŸ¥æ¯ä¸ªç´¢å¼•æ“ä½œã€‚

æˆ‘ä»¬ä¹‹å‰æœ‰ä¸€ä¸ªï¼Œä¸€ç³»åˆ—æ•´æ•°æ€»å’Œçš„ä¾‹å­ã€‚å®ƒæ¶‰åŠä¸€ä¸ª`mut`å˜é‡å’Œå¾ªç¯ã€‚ä»¥ä¸‹æ˜¯ _æƒ¯ç”¨çš„_ï¼Œæ€»å’Œæ–¹å¼:

```rust
// sum1.rs
fn main() {
    let sum: i32  = (0..5).sum();
    println!("sum was {}", sum);

    let sum: i64 = [10, 20, 30].iter().sum();
    println!("sum was {}", sum);
}
```

è¯·æ³¨æ„ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€ä¸ªéœ€è¦æ˜ç¡®è¯´æ˜çš„æƒ…å†µï¼Œå°±æ˜¯è¯¥å˜é‡çš„ _ç±»å‹_ ï¼Œå› ä¸ºä¸è¿™æ ·åšï¼ŒRust å°±æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨ä¸¤ä¸ªä¸åŒçš„æ•´æ•°åšæ€»å’Œï¼Œæ²¡æœ‰é—®é¢˜ã€‚(å¦‚æœç”¨å°½æ‰€æœ‰çš„åå­—ï¼Œé‚£åˆ›å»ºä¸€ä¸ªæ–°çš„åŒåå˜é‡ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚)

ä¸ºäº†æ‰©å±•éœ€è¦ï¼Œè¿™æœ‰æ›´å¤šçš„[åˆ‡ç‰‡ æ–¹æ³•](https://doc.rust-lang.org/std/primitive.slice.html)ã€‚(å¦ä¸€ä¸ªæ–‡æ¡£æç¤º;åœ¨æ¯ä¸ªæ–‡æ¡£é¡µçš„å³è¾¹æœ‰ä¸€ä¸ª'[-]ï¼Œå¯å•å‡»è¯¥æŒ‰é’®ä»¥æŠ˜å æ–¹æ³•åˆ—è¡¨ã€‚ç„¶åä½ å¯ä»¥æ‰©å±•ä»»ä½•çœ‹èµ·æ¥å¾ˆæœ‰è¶£çš„ç»†èŠ‚ã€‚é‚£äº›çœ‹èµ·æ¥æ€ªå¼‚çš„ä¸œè¥¿ï¼Œç°åœ¨å°±å¿½ç•¥å®ƒå§ã€‚

è¿™ä¸ª`windows`æ–¹æ³•ï¼Œæä¾›äº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå±‚å çš„å€¼çª—å£ã€‚

```rust
// slice4.rs
fn main() {
    let ints = [1, 2, 3, 4, 5];
    let slice = &ints;

    for s in slice.windows(2) {
        println!("window {:?}", s);
    }
}
// window [1, 2]
// window [2, 3]
// window [3, 4]
// window [4, 5]
```

æˆ–`å—{chunks}`:

```rust
    for s in slice.chunks(2) {
        println!("chunks {:?}", s);
    }
// chunks [1, 2]
// chunks [3, 4]
// chunks [5]
```

## æ›´å¤šå…³äºå‘é‡

æœ‰ä¸€ä¸ªæœ‰ç”¨çš„å°å®`vec!`ç”¨äºåˆå§‹åŒ–å‘é‡ã€‚æ³¨æ„ä½ å¯ä»¥ä½¿ç”¨`pop` _å»é™¤{remove}_ å‘é‡ç»“å°¾å€¼ï¼Œå’Œ _æ‰©å±•{extend}_ ä¸€ä¸ªå…¼å®¹è¿­ä»£å™¨çš„å‘é‡ã€‚

```rust
// vec3.rs
fn main() {
    let mut v1 = vec![10, 20, 30, 40];
    v1.pop();

    let mut v2 = Vec::new();
    v2.push(10);
    v2.push(20);
    v2.push(30);

    assert_eq!(v1, v2);

    v2.extend(0..2);
    assert_eq!(v2, &[10, 20, 30, 0, 1]);
}
```

éªŒè¯å‘é‡ï¼Œå®ƒä»¬ä¹‹é—´æ¯ä¸ªå¯¹åº”å€¼éƒ½ç›¸äº’æ¯”è¾ƒï¼Œåˆ‡ç‰‡ä¸ºå€¼ã€‚

å¯ä»¥å°†å€¼æ’å…¥åˆ°å‘é‡ä¸­çš„ä»»æ„ä½ç½®ã€‚`æ’å…¥{insert}`æˆ–è€…ä½¿ç”¨`å»é™¤{remove}`ç§»é™¤ã€‚
è¿™ä¸åƒ push å’Œ pop ä¸€æ ·é«˜æ•ˆ
ï¼Œè¿™äº›å€¼å°†ä¸å¾—ä¸è¢«ç§»åŠ¨ä»¥è…¾å‡ºç©ºé—´ï¼Œæ‰€ä»¥è¯·å°å¿ƒè¿™äº›æ“ä½œ
å‘é‡ã€‚

vec å…·æœ‰å¤§å°å’Œ _capacity{å®¹é‡}_ã€‚å¦‚æœä½ æ¸…é™¤äº†ä¸€ä¸ª vec ï¼Œå®ƒçš„å¤§å°å°±å˜æˆäº†é›¶ï¼Œ
ä½†å®ƒä»ä¿ç•™å…¶æ—§å®¹é‡ã€‚æ‰€ä»¥ç”¨`push`ç­‰æ¥å¡«å……ï¼Œåªä¼š
å½“å°ºå¯¸å¤§äºè¯¥å®¹é‡æ—¶ï¼Œæ‰ä¼šé‡æ–°åˆ†é…å®¹é‡ã€‚

vec å¯ä»¥æ’åºï¼Œç„¶åå¯ä»¥åˆ é™¤é‡å¤çš„ - è¿™äº›æ“ä½œå°±åœ¨ vec ä¸Šã€‚(å¦‚æœä½ æƒ³å…ˆå¤åˆ¶ï¼Œå¯ä½¿ç”¨`clone`).

```rust
// vec4.rs
fn main() {
    let mut v1 = vec![1, 10, 5, 1, 2, 11, 2, 40];
    v1.sort();
    v1.dedup();
    assert_eq!(v1, &[1, 2, 5, 10, 11, 40]);
}
```

## å­—ç¬¦ä¸²

Rust ä¸­çš„å­—ç¬¦ä¸²æ¯”å…¶ä»–è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ›´å¤æ‚ä¸€äº›; `String`ç±»å‹ï¼Œ
åƒ`Vec`ï¼ŒåŠ¨æ€åˆ†é…å¹¶å¯è°ƒæ•´å¤§å°ã€‚ï¼ˆæ‰€ä»¥å®ƒå°±åƒ C ++ çš„`std::string`
ä½†ä¸åƒ Java å’Œ Python çš„ä¸å¯å˜å­—ç¬¦ä¸²ã€‚ï¼‰ä½†æ˜¯ä¸€ä¸ªç¨‹åºå¯èƒ½åŒ…å«å¾ˆå¤š
_string literals {å­—ç¬¦ä¸²å¸¸é‡}_ï¼ˆå¦‚"hello"ï¼‰å’Œç³»ç»Ÿè¯­è¨€åº”è¯¥èƒ½å¤Ÿåœ¨æ‰§è¡Œæ—¶é™æ€å­˜å‚¨è¿™äº›
ã€‚è‹¥æ”¾åœ¨å¾®å‹åµŒå…¥å¼æ¥è¯´ï¼Œè¿™å¯èƒ½æ„å‘³ç€å­˜åœ¨
äº å»‰ä»·çš„ ROM è€Œä¸æ˜¯ æ˜‚è´µçš„ RAMï¼ˆå¯¹ä½åŠŸè€—è®¾å¤‡æ¥è¯´ï¼ŒRAM æ˜¯
åœ¨åŠŸè€—æ–¹é¢ä¹Ÿå¾ˆæ˜‚è´µã€‚ï¼‰æ‰€ä»¥ _ç³»ç»Ÿ_ è¯­è¨€å¿…é¡»å…·æœ‰
ä¸¤ç§å­—ç¬¦ä¸²ï¼Œåˆ†é…çš„ä¸é™æ€çš„ã€‚

æ‰€ä»¥"hello"ä¸æ˜¯`String`ç±»å‹ã€‚å®ƒæ˜¯`ï¼†str`ç±»å‹ï¼ˆå‘éŸ³ä¸º'string slice'ï¼‰ã€‚
è¿™å°±åƒ C ++ ä¸­ `const char*`å’Œ `std::string` ä¹‹é—´çš„åŒºåˆ«ï¼Œé™¤äº†
`ï¼†str`æ›´æ™ºèƒ½ã€‚å®é™…ä¸Šï¼Œ`ï¼†str`å’Œ`String`æœ‰ä¸€ä¸ªå¾ˆå¥½çš„çš„ç›¸ä¼¼å…³ç³»
å°±æ˜¯`&[T]`åˆ°`Vec<T>`ã€‚

```rust
// string1.rs
fn dump(s: &str) {
    println!("str '{}'", s);
}

fn main() {
    let text = "hello dolly";  // string åˆ‡ç‰‡
    let s = text.to_string();  // ç°å˜æˆ å·²åˆ†é…çš„ string

    dump(text);
    dump(&s);
}
```

å†æ¬¡, å€Ÿç”¨ç¬¦å· å¯ä»¥è¿«ä½¿`String`æˆä¸º`&str`, å°±åƒ`Vec<T>`èƒ½è¢«è¿«ä½¿è¿›`&[T]`ã€‚

åœ¨å¼•æ“ç›–ä¸‹ï¼Œ`String`åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª`Vec<u8>`ï¼Œå’Œ`&str`æ˜¯ä¸€ä¸ª`&[u8]`, ä½†æ˜¯é‚£äº›å­—èŠ‚ _å¿…é¡»_ è¡¨ç¤ºæœ‰æ•ˆçš„ UTF-8 æ–‡æœ¬ã€‚

å°±åƒä¸€ä¸ª Vecï¼Œä½ å¯ä»¥`push`ä¸€ä¸ªå­—ç¬¦ï¼Œå’Œ`pop`å‡º`String`ç»“å°¾:

```rust
// string5.rs
fn main() {
    let mut s = String::new();
    // åˆå§‹åŒ– ç©ºçš„!
    s.push('H');
    s.push_str("ello");
    s.push(' ');
    s += "World!"; //  `push_str`çš„ç®€å†™
    // ç§»é™¤æœ€åçš„char
    s.pop();

    assert_eq!(s, "Hello World");
}
```

`to_string`å¯ä»¥å°†è®¸å¤šç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚(å¦‚æœå¯ä»¥ç”¨"{}"æ‰“å°å®ƒä»¬ï¼Œé‚£ä¹ˆå®ƒä»¬å°±å¯ä»¥è¢«è½¬æ¢) . `format!`æ˜¯åƒ`println!`ä½¿ç”¨ç›¸åŒçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œä½†æ„å»ºæ›´å¤æ‚çš„å­—ç¬¦ä¸²çš„ä¸€ç§éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚

```rust
// string6.rs
fn array_to_str(arr: &[i32]) -> String {
    let mut res = '['.to_string();
    for v in arr {
        res += &v.to_string();
        res.push(',');
    }
    res.pop();
    res.push(']');
    res
}

fn main() {
    let arr = array_to_str(&[10, 20, 30]);
    let res = format!("hello {}", arr);

    assert_eq!(res, "hello [10,20,30]");
}
```

æ³¨æ„`&`åœ¨å‰é¢çš„`v.to_string()`- `&`ç¬¦å·è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œä¸æ˜¯`String`è‡ªèº«(`to_string`è¿”å›)ï¼Œå› æ­¤ï¼Œå®ƒéœ€è¦ä¸€ç‚¹æ‰‹æ³•æ¥åŒ¹é…ã€‚

> å°è¯¾å ‚ï¼š`v`æœ¬èº«æ˜¯`&i32`ç±»å‹ï¼Œé€šè¿‡`to_string`è½¬ä¸º`String`,å†é€šè¿‡`&`ç¬¦å·è½¬ä¸º`&str`ï¼Œè®© res çš„`+=`è¯­æ³•ç³–(ä¹Ÿå°±æ˜¯`add_assign`æ–¹æ³•)æ“ä½œå¯ä»¥æˆåŠŸã€‚[å®˜æ–¹æ–‡æ¡£](https://doc.rust-lang.org/std/string/struct.String.html#impl-AddAssign%3C%26%27a%20str%3E)

ç”¨äºåˆ‡ç‰‡çš„`..`ä¹Ÿä¸å­—ç¬¦ä¸²ä¸€èµ·å·¥ä½œ:

```rust
// string2.rs
fn main() {
    let text = "static";
    let string = "dynamic".to_string();

    let text_s = &text[1..];
    let string_s = &string[2..4];

    println!("slices {:?} {:?}", text_s, string_s);
}
// slices "tatic" "na"
```

ä½†æ˜¯ï¼Œä½ ä¸èƒ½ç´¢å¼•å­—ç¬¦ä¸²! è¿™æ˜¯å› ä¸ºå®ƒä»¬ä½¿ç”¨çš„æ˜¯ å”¯(ä¸€)çœŸ(æ­£)ç¼–ç  UTF-8ï¼Œå…¶ä¸­çš„"character"å¯èƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ã€‚

```rust
// string3.rs
fn main() {
    let multilingual = "Hi! Â¡Hola! Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚!";
    for ch in multilingual.chars() {
        print!("'{}' ", ch);
    }
    println!("");
    println!("len {}", multilingual.len());
    println!("count {}", multilingual.chars().count());

    let maybe = multilingual.find('Ğ¿');
    if maybe.is_some() {
        let hi = &multilingual[maybe.unwrap()..];
        println!("Russian hi {}", hi);
    }
}
// 'H' 'i' '!' ' ' 'Â¡' 'H' 'o' 'l' 'a' '!' ' ' 'Ğ¿' 'Ñ€' 'Ğ¸' 'Ğ²' 'Ğµ' 'Ñ‚' '!'
// len 25
// count 18
// Russian hi Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚!
```

âš ï¸ ç°åœ¨,è®©æˆ‘ä»¬æ€è€ƒä¸‹ - æœ‰ 25 ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åªæœ‰ 18 ä¸ªå­—ç¬¦! ä½†æ˜¯,å¦‚æœä½ ä½¿ç”¨ç±»ä¼¼`find`çš„æ–¹æ³•ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„ç´¢å¼•(å¦‚æœæœ‰çš„è¯)å’Œä»»æ„åˆ‡ç‰‡ä¹Ÿä¼šæ²¡äº‹ã€‚

( Rust çš„`char`ç±»å‹æ˜¯ä¸€ä¸ª 4 å­—èŠ‚çš„ Unicode ä»£ç ç‚¹ã€‚æ‰€ä»¥å­—ç¬¦ä¸²ä¸æ˜¯å­—ç¬¦
çš„æ•°ç»„!)

å­—ç¬¦ä¸²åˆ‡ç‰‡å¯èƒ½ä¼šåƒ Vec ç´¢å¼•ä¸€æ ·çˆ†ç‚¸ï¼Œå› ä¸ºå®ƒä½¿ç”¨å­—èŠ‚åç§»é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ
è¯¥å­—ç¬¦ä¸²ç”±ä¸¤ä¸ªå­—èŠ‚ç»„æˆï¼Œæ‰€ä»¥è¯•å›¾æ‹‰å‡ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¯æ˜¯ä¸€ä¸ª Unicode é”™è¯¯ã€‚æ‰€ä»¥ï¼Œ
æ³¨æ„åªä½¿ç”¨æ¥è‡ªå­—ç¬¦ä¸²æ–¹æ³•çš„æœ‰æ•ˆåç§»æ¥åˆ‡åˆ†å­—ç¬¦ä¸²ã€‚

```rust
    let s = "Â¡";
    println!("{}", &s[0..1]); // <-- é”™, è¿™æ˜¯å¤šå­—èŠ‚å­—ç¬¦çš„ç¬¬ä¸€ä¸ªå­—èŠ‚
```

æ‹†è§£å­—ç¬¦ä¸²æ˜¯ä¸€ç§å¸¸è§å’Œæœ‰ç”¨çš„æ–¹å¼ã€‚å­—ç¬¦ä¸²çš„`split_whitespace`
æ–¹æ³•è¿”å›ä¼š _è¿­ä»£å™¨_ï¼Œç„¶åï¼Œæˆ‘ä»¬å°±é€‰æ‹©å»å¦‚ä½•å¤„ç†å®ƒã€‚ä¸€ä¸ªä¸»è¦åšæ³•æ˜¯éœ€è¦
åˆ›å»ºæ‹†åˆ†å­ä¸²çš„ vec ã€‚

`collect`éå¸¸æ™®éï¼Œå› æ­¤éœ€è¦ä¸€äº›å…³äºï¼Œå¤„äº collect çš„çº¿ç´¢ï¼Œä¹Ÿå°±æ˜¯çœ‹å…¶
æ˜¾å¼çš„ç±»å‹ã€‚

```rust
    let text = "the red fox and the lazy dog";
    let words: Vec<&str> = text.split_whitespace().collect();
    // ["the", "red", "fox", "and", "the", "lazy", "dog"]
```

ä½ ä¹Ÿå¯ä»¥è¿™æ ·è¯´ï¼Œä¼ é€’è¿­ä»£å™¨åˆ°`æ‰©å±•{extend}`æ–¹æ³•:

```rust
    let mut words = Vec::new();
    words.extend(text.split_whitespace());
```

åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸åˆ¶ä½œè¿™äº› _åˆ†ç¦»çš„ï¼Œå·²åˆ†é… å­—ç¬¦ä¸²_ï¼Œ
è€Œåœ¨è¿™é‡Œï¼ŒVec ä¸­çš„æ¯ä¸ªç‰‡æ®µï¼Œéƒ½æ˜¯ä»åŸå§‹å­—ç¬¦ä¸²ä¸­å€Ÿç”¨çš„ã€‚
æˆ‘ä»¬æ‰€åˆ†é…çš„æ˜¯æŒæœ‰åˆ‡ç‰‡çš„ä½ç½®ã€‚

çœ‹çœ‹è¿™ä¸ªå¯çˆ±çš„åŒçº¿`| |`; æˆ‘ä»¬ä»`chars`å¾—åˆ°äº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ
å¹¶åªè¦é‚£äº›ä¸æ˜¯ ç©ºæ ¼ çš„å­—ç¬¦ã€‚å†æ¬¡ï¼Œ`collect`éœ€è¦
ä¸€ä¸ªçº¿ç´¢ï¼ˆæˆ‘ä»¬å¯èƒ½æƒ³è¦ä¸€ä¸ª å­—ç¬¦ä¸²å‘é‡=String):

```rust
    let stripped: String = text.chars()
        .filter(|ch| ! ch.is_whitespace()).collect();
    // theredfoxandthelazydog
```

è¿™`filter`æ–¹æ³•æ¥å—ä¸€ä¸ª _é—­åŒ…å‡½æ•°_ï¼Œè¿™æ˜¯ Rust çš„ lambdas/åŒ¿åå‡½æ•°ã€‚è¿™é‡Œçš„å‚æ•°ç±»å‹ä»ä¸Šä¸‹æ–‡ä¸­æ˜¯æ¸…æ¥šçš„ï¼Œæ‰€ä»¥æ˜¾å¼è§„åˆ™æ˜¯æ”¾æ¾äº†çš„ã€‚

å°±æ˜¯è¿™æ ·ï¼Œä½ å¯ä»¥è¿™æ ·æå®š chars çš„æ˜¾å¼å¾ªç¯ï¼Œå°†è¿”å›çš„å­—ç¬¦åˆ‡ç‰‡æ¨é€åˆ°ä¸€ä¸ªå¯å˜çš„å‘é‡ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ›´çŸ­ï¼Œè¯»å–æ€§å¾ˆå¥½ ( _å½“_ ä½ ä¹ æƒ¯äº†)ï¼ŒåŒæ ·ä¹Ÿå¾ˆå¿«ã€‚ä½¿ç”¨ä¸€ä¸ªå¾ªç¯çš„æ–¹å¼ä¸æ˜¯ä¸€ç§ _é”™_ ï¼Œç„¶è€Œï¼Œæˆ‘ä¼šé¼“åŠ±ä½ ï¼Œä¹Ÿå†™è¿™ä¸ªä¸€ä¸²è¿‡çš„ç‰ˆæœ¬ã€‚

## æ’æ›²: è·å–å‘½ä»¤è¡Œå‚æ•°

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„èŠ‚ç›®éƒ½ç”Ÿæ´»åœ¨å¯¹å¤–ç•Œçš„æ— çŸ¥ä¹‹ä¸­;ç°åœ¨æ˜¯æ—¶å€™ç»™ä»–ä»¬æä¾›æ•°æ®ã€‚

`std::env::args`æ˜¯ä½ å¦‚ä½•è®¿é—®å‘½ä»¤è¡Œå‚æ•°æ³•å®;å®ƒè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ä½œä¸ºå­—ç¬¦ä¸²çš„å‚æ•°,åŒ…æ‹¬ç¨‹åºåã€‚

```rust
// args0.rs
fn main() {
    for arg in std::env::args() {
        println!("'{}'", arg);
    }
}
```

```
src$ rustc args0.rs
src$ ./args0 42 'hello dolly' frodo
'./args0'
'42'
'hello dolly'
'frodo'
```

è¿”å›ä¸€ä¸ª`Vec`ä¼šæ›´å¥½å—? è¿™å¾ˆå®¹æ˜“ï¼Œä½¿ç”¨`collect`åˆ¶ä½œè¿­ä»£å™¨ï¼Œä½¿ç”¨è¯¥å‘é‡çš„`skip`æ–¹æ³•è·³è¿‡ç¨‹åºåã€‚

```rust
    let args: Vec<String> = std::env::args().skip(1).collect();
    if args.len() > 0 { // we have args!
        ...
    }
```

è¿™è¿˜ä¸é”™;å‡ ä¹æ‰€æœ‰çš„è¯­è¨€éƒ½ä¼šè¿™æ ·åš.

è¯»å–å•ä¸ªå‚æ•°çš„ æ›´ Rust-y ç‰¹è‰²çš„æ–¹æ³•(ä¼ é€’ä¸€ä¸ªæ•´æ•°å€¼):

```rust
// args1.rs
use std::env;

fn main() {
    let first = env::args().nth(1).expect("please supply an argument");
    let n: i32 = first.parse().expect("not an integer!");
    // do your magic
}
```

`nth(1)`ä¸ºæ‚¨æä¾›è¿­ä»£å™¨çš„ç¬¬äºŒä¸ªå€¼ï¼Œä»¥åŠ`expect`æ–¹æ³•å°±åƒä¸€ä¸ª`unwrap`ä½†å¸¦æœ‰å¯è¯»çš„ä¿¡æ¯ã€‚

å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—å¾ˆç®€å•ï¼Œä½†æ‚¨éœ€è¦æŒ‡å®šå€¼çš„ç±»å‹ - è¿˜æœ‰ä»€ä¹ˆæ˜¯å¯ä»¥`parse`çš„ï¼Œä½ çŸ¥é“å—?

è¿™ä¸ªç¨‹åºå¯èƒ½ä¼šææ…Œ{panic}ï¼Œä¸è¿‡å¯¹ç¬¨æ‹™çš„æµ‹è¯•ç¨‹åºæ¥è¯´è¿˜èƒ½ç”¨ã€‚ä½†ä¸è¦å¤ªä¹ æƒ¯äºè¿™ç§æ–¹ä¾¿çš„æƒ³æ³•ã€‚

## åŒ¹é…

æˆ‘ä»¬æå–ä¿„ç½—æ–¯é—®å€™è¯­çš„`string3.rs`ä»£ç ï¼Œå¹¶ä¸æ˜¯é€šå¸¸çš„å†™æ³•ã€‚è¿›å…¥ _match_ çš„ä¸–ç•Œå§ï¼š

```rust
    match multilingual.find('Ğ¿') {
        Some(idx) => {
            let hi = &multilingual[idx..];
            println!("Russian hi {}", hi);
        },
        None => println!("couldn't find the greeting, Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¸Ñ‰")
    };
```

`match`åŒ…æ‹¬å‡ ä¸ª _æ¨¡å¼{patterns}_ ï¼Œç”¨ä¸€ä¸ªåŒ¹é…å€¼å’Œåè·Ÿ èƒ–ç®­å¤´,ç”¨é€—å·åˆ†éš”ã€‚å®ƒæ–¹ä¾¿åœ°ï¼Œå°†`Options`ä¸­çš„å€¼ä¸`idx`æŸç¼šèµ·æ¥ã€‚ä½  _å¿…é¡»_ æŒ‡å®šæ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¤„ç†`None`ã€‚

ä¸€æ—¦ä½ ä¹ æƒ¯äº† (æˆ‘çš„æ„æ€æ˜¯ï¼Œæ‰“å¤šå‡ é)ï¼Œæ„Ÿè§‰æ¯”`is_some`æ£€æŸ¥æ›´è‡ªç„¶ï¼Œå› æ£€æŸ¥è¿˜éœ€è¦ä¸€ä¸ªé¢å¤–çš„`Option`å­˜å‚¨ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ å¯¹è¿™é‡Œçš„å¤±è´¥ä¸æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆ`if let`ä¼šæ˜¯ä½ çš„æœ‹å‹:

```rust
    if let Some(idx) = multilingual.find('Ğ¿') {
        println!("Russian hi {}", &multilingual[idx..]);
    }
```

å¦‚æœä½ æƒ³åšä¸€æ¬¡åŒ¹é…ï¼Œä¸” _åª_ å¯¹ä¸€ä¸ªå¯èƒ½çš„ç»“æœæ„Ÿå…´è¶£ï¼Œé‚£è¿™æ— ç–‘æ˜¯ä¸ªæ–¹ä¾¿çš„å†™æ³•ã€‚

`åŒ¹é…{match}`ä¹Ÿä¼šåƒä¸€ä¸ª C çš„`switch`å£°æ˜ï¼Œå°±åƒå…¶ä»– Rust æ„é€ ä¸€æ ·å¯ä»¥è¿”å›ä¸€ä¸ªå€¼:

```rust
    let text = match n {
        0 => "zero",
        1 => "one",
        2 => "two",
        _ => "many",
    };
```

è¿™ä¸ª`_`å°±åƒ C çš„`default`ï¼Œæ˜¯ä¸€ä¸ªå¤‡ç”¨æƒ…å†µã€‚å¦‚æœä½ ä¸æä¾›ä¸€ä¸ªé»˜è®¤, `rustc`ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚(åœ¨ C++ä¸­ï¼Œæœ€å¥½çš„æœŸæœ›æ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œä¼šè¯´å¾ˆå¤šå…³äºå„è‡ªçš„è¯­è¨€)ã€‚

Rust çš„`åŒ¹é…`è¯­å¥ä¹Ÿå¯ä»¥åŒ¹é…èŒƒå›´ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›èŒƒå›´æ˜¯æœ‰
_three{ä¸‰ä¸ª}_ ç‚¹ ï¼Œå¹¶ä¸”æ˜¯å…¨åŒ…å«æ€§çš„èŒƒå›´ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ¡ä»¶å°†åŒ¹é… 3ã€‚

```rust
    let text = match n {
        0...3 => "small",
        4...6 => "medium",
        _ => "large",
     };
```

## è¯»å–æ–‡ä»¶

ä¸‹ä¸€æ­¥æ˜¯å‘ä¸–ç•Œå±•ç¤ºçš„ï¼Œæ˜¯ _è¯»å–æ–‡ä»¶_ã€‚

å›æƒ³ä¸€ä¸‹ï¼Œ`expect`å°±åƒ`unwrap`ï¼Œä½†å¯è‡ªå®šä¹‰ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ã€‚
åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šæ‰”æ‰ä¸€äº›é”™è¯¯:

```rust
// file1.rs
use std::env;
use std::fs::File;
use std::io::Read;

fn main() {
    let first = env::args().nth(1).expect("please supply a filename");

    let mut file = File::open(&first).expect("can't open the file");

    let mut text = String::new();
    file.read_to_string(&mut text).expect("can't read the file");

    println!("file had {} bytes", text.len());

}
```

```
src$ file1 file1.rs
file had 366 bytes
src$ ./file1 frodo.txt
thread 'main' panicked at 'can't open the file: Error { repr: Os { code: 2, message: "No such file or directory" } }', ../src/libcore/result.rs:837
note: Run with `RUST_BACKTRACE=1` for a backtrace.
src$ file1 file1
thread 'main' panicked at 'can't read the file: Error { repr: Custom(Custom { kind: InvalidData, error: StringError("stream did not contain valid UTF-8") }) }', ../src/libcore/result.rs:837
note: Run with `RUST_BACKTRACE=1` for a backtrace.
```

æ‰€ä»¥ï¼Œ`open`ä¼šå¤±è´¥ï¼Œå› ä¸ºè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æˆ‘ä»¬ä¸å…è®¸è¯»å®ƒï¼Œç„¶åï¼Œ`read_to_string`ä¹Ÿä¼šå¤±è´¥ï¼Œå› ä¸ºè¯¥æ–‡ä»¶ä¸åŒ…å«æœ‰æ•ˆçš„ UTF-8ã€‚(è™½ç„¶è¿™ä¹ˆè¯´ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨`read_to_end`å¹¶å°† å…¶å†…å®¹ ç”¨ ä¸€ä¸ªå­—èŠ‚ vec æ›¿ä»£ã€‚) å¯¹äºä¸å¤ªå¤§çš„æ–‡ä»¶ï¼Œä¸€å£ä¸€å£åœ°è¯»å–å®ƒä»¬æ˜¯æœ‰ç”¨çš„ï¼Œä¸”ç›´æ¥ã€‚

å¦‚æœä½ çŸ¥é“å…¶ä»–è¯­è¨€çš„æ–‡ä»¶å¤„ç†ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦çŸ¥é“ï¼Œæ–‡ä»¶ä»€ä¹ˆæ—¶å€™ _å…³é—­{closed}_ã€‚å¦‚æœæˆ‘ä»¬æ­£åœ¨å†™å…¥è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸å…³é—­å®ƒï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä½†æ˜¯è¿™é‡Œå•Šï¼Œå½“å‡½æ•°ç»“æŸæ—¶ï¼Œæ–‡ä»¶å°±ä¼šè¢«å…³é—­ï¼Œåº”`file`å˜é‡è¢« _é‡Šæ”¾{dropped}_ äº†ã€‚

è¦çŸ¥é“"æŠ›å‡ºé”™è¯¯(throw-catch)"çš„åšæ³•ä¹ æƒ¯æ˜¯å¾ˆç³Ÿç³•çš„ã€‚ä½ ä¸ä¼šæƒ³å°†è¿™äº›ä»£ç æ”¾å…¥å‡½æ•°ä¸­ï¼Œå› ä¸ºå®ƒçŸ¥é“ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿æ•´ä¸ªç¨‹åºå´©æºƒã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¿…é¡»è°ˆè®ºï¼Œ`File::open`åˆ°åº•è¿”å›ä»€ä¹ˆã€‚å¦‚æœ`Option`æ˜¯ä¸€ä¸ªå€¼ï¼Œå…¶å¯èƒ½åŒ…å«æˆ–ä¸åŒ…å«ä»»ä½•å†…å®¹ï¼Œé‚£ä¹ˆ`Result`å°±æ˜¯ä¸€ä¸ªå¯èƒ½åŒ…å«æŸäº›å†…å®¹æˆ–ä¸€ä¸ªé”™è¯¯çš„å€¼ã€‚ä»–ä»¬éƒ½æ˜ç™½`unwrap` (å’Œå®ƒçš„è¡¨å¼Ÿ`expect`) ï¼Œä½†å®ƒä»¬å®Œå…¨ä¸åŒã€‚`Result`æ˜¯ç”± _äºŒç§_ ç±»å‹å‚æ•°å®šä¹‰çš„ï¼Œåˆ†åˆ«æ˜¯`Ok`å€¼å’Œ`Err`å€¼ã€‚`Result`'ç›’å­' æœ‰ä¸¤ä¸ªéš”é—´ï¼Œä¸€ä¸ªæ ‡ç­¾æ˜¯`Ok`è€Œå¦ä¸€ä¸ªæ˜¯`Err`.

```rust
fn good_or_bad(good: bool) -> Result<i32,String> {
    if good {
        Ok(42)
    } else {
        Err("bad".to_string())
    }
}

fn main() {
    println!("{:?}",good_or_bad(true));
    //Ok(42)
    println!("{:?}",good_or_bad(false));
    //Err("bad")

    match good_or_bad(true) {
        Ok(n) => println!("Cool, I got {}",n),
        Err(e) => println!("Huh, I just got {}",e)
    }
    // Cool, I got 42

}
```

(å®é™…çš„"é”™è¯¯"ç±»å‹æ˜¯éšæ„çš„ï¼Œå¾ˆå¤šäººä½¿ç”¨å­—ç¬¦ä¸²ï¼Œç›´åˆ°äººä»¬å¯¹ Rust é”™è¯¯ç±»å‹äº§ç”Ÿå…´è¶£)ã€‚è¿™æ˜¯è¿”å›ä¸€ä¸ªå€¼ _æˆ–_ å¦ä¸€ä¸ªå€¼çš„æ–¹ä¾¿æ–¹æ³•ã€‚

è¿™äº›æ–‡ä»¶è¯»å–å‡½æ•°ç‰ˆæœ¬æ˜¯ä¸ä¼šå´©æºƒã€‚å› å®ƒè¿”å›ä¸€ä¸ª`Result`ï¼Œå½“ç„¶è¿˜è¦ _å‘¼å«è€…{caller}_ å†³å®šå¦‚ä½•å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚

```rust
// file2.rs
use std::env;
use std::fs::File;
use std::io::Read;
use std::io;

fn read_to_string(filename: &str) -> Result<String,io::Error> {
    let mut file = match File::open(&filename) {
        Ok(f) => f,
        Err(e) => return Err(e),
    };
    let mut text = String::new();
    match file.read_to_string(&mut text) {
        Ok(_) => Ok(text),
        Err(e) => Err(e),
    }
}

fn main() {
    let file = env::args().nth(1).expect("please supply a filename");

    let text = read_to_string(&file).expect("bad file man!");

    println!("file had {} bytes", text.len());
}
```

ç¬¬ä¸€æ¬¡åŒ¹é… ä»`Ok`å®‰å…¨åœ°æå–å€¼ï¼Œè¿™å°±æˆäº†è¯¥ match çš„å€¼ã€‚å¦‚æœå®ƒæ˜¯`Err`ï¼Œå°±è¿”å›é”™è¯¯ï¼Œå¹¶é‡æ–°åŒ…è£…ä¸ºä¸€ä¸ª`Err`ã€‚

ç¬¬äºŒä¸ªåŒ¹é…è¿”å›å­—ç¬¦ä¸²ï¼ŒåŒ…è£…ä¸º`Ok`ï¼Œå¦åˆ™è¿”å›
ï¼ˆå†ä¸€æ¬¡ï¼‰é”™è¯¯ã€‚`Ok`ä¸­çš„å®é™…å€¼ä¸é‡è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨`_`å¿½ç•¥
å®ƒã€‚

å½“ä¸€ä¸ªå‡½æ•°çš„å¤§éƒ¨åˆ†åœ¨å¤„ç†é”™è¯¯æ—¶ï¼Œä¼šä¸å¤ªå¥½çœ‹; é‚£ä¹ˆ
'å¿«ä¹'å°±ä¼šè¿·å¤±äº†ã€‚å¾€å¾€è¿™ä¸ªé—®é¢˜ï¼Œä¼´æœ‰å¾ˆå¤š
æ˜ç¡®çš„æå‰è¿”å›ï¼Œæˆ–è€…æ˜¯ _ignoring errors{å¿½è§†äº†é”™è¯¯}_ ã€‚ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ
è¿™å¯æ˜¯åœ¨ Rust ä¸–ç•Œä¸­ï¼Œæœ€æ¥è¿‘é‚ªæ¶çš„ä¸œè¥¿ã€‚ï¼‰

å¹¸è¿çš„æ˜¯,æœ‰ä¸€ä¸ªæ·å¾„ã€‚

`std::io`æ¨¡å—å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼Œåä¸º`io::Result<T>`ç±»å‹ï¼Œè¿™ä¸`Result<T,io::Error>`ç›¸åŒï¼Œä½†æ›´å®¹æ˜“çš„ç±»å‹ã€‚

```rust
fn read_to_string(filename: &str) -> io::Result<String> {
    let mut file = File::open(&filename)?; // <== ?
    let mut text = String::new();
    file.read_to_string(&mut text)?;
    Ok(text)
}
```

è¿™é‡Œçš„`?`, ä¹Ÿå‡ ä¹å®Œå…¨åŒ¹é…äº†`File::open`æ‰€åšçš„ï¼›å¦‚æœå…¶ç»“æœæ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆå®ƒå°†ç«‹å³è¿”å›é”™è¯¯ã€‚å¦åˆ™,å®ƒå°†è¿”å›`Ok`ç»“æœã€‚
æœ€åï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æŠŠè¯¥å­—ç¬¦ä¸²åŒ…æˆä¸€ä¸ª `Result` ç±»å‹ã€‚

2017 å¹´æ˜¯ä¸€ä¸ª Rust çš„å¥½å¹´ï¼Œè¿˜æœ‰é…·é…·çš„`?`ä¹Ÿå˜å¾—ç¨³å®šã€‚ä½ ä¹Ÿèƒ½çœ‹åˆ°ç”¨äºæ—§ä»£ç çš„`try!`å®:

```rust
fn read_to_string(filename: &str) -> io::Result<String> {
    let mut file = try!(File::open(&filename));
    let mut text = String::new();
    try!(file.read_to_string(&mut text));
    Ok(text)
}
```

æ€»è€Œè¨€ä¹‹ï¼Œä½ å¯ä»¥ç¼–å†™å®Œå…¨å®‰å…¨ï¼Œä¸”ä¸ä¸‘çš„ Rust ä»£ç ï¼Œä¸éœ€è¦ä»€ä¹ˆå¼‚å¸¸æ•è·ã€‚
